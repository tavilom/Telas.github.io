<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="img/pinheiro.svg" type="image/x-icon" />
    <link rel="stylesheet" href="style.css">
    <title>Telas do Figma</title>
  </head>

  <body>
    <header>
      <nav id="navbar" class="navbar">
        <h1 id="h1" class="h1">Visualizador de protótipos</h1>
      </nav>
    </header>

    <div class="wrap">
      <div class="carousel" aria-label="Carrossel de protótipos">
        <button
          class="nav prev"
          id="prev"
          aria-label="Anterior"
          title="Anterior"
        >
          ‹
        </button>

        <div class="viewport" id="viewport" tabindex="0">
          <div class="track" id="tiles">
            <button
              class="tile"
              data-url="https://embed.figma.com/proto/Yr12PfEGdeRbbHJpeFA6T1/Unimed?node-id=495-1379&p=f&scaling=min-zoom&content-scaling=fixed&page-id=495%3A556&starting-point-node-id=495%3A1379&embed-host=share"
            >
              <span>Oportunidades — Unimed</span>
            </button>

            <button
              class="tile"
              data-url="https://embed.figma.com/proto/Yr12PfEGdeRbbHJpeFA6T1/Unimed?node-id=510-2752&p=f&scaling=min-zoom&content-scaling=fixed&page-id=510%3A1554&embed-host=share"
            >
              <span>OPME</span>
            </button>

            <button
              class="tile"
              data-url="https://embed.figma.com/proto/Yr12PfEGdeRbbHJpeFA6T1/Unimed?node-id=1-2&p=f&scaling=min-zoom&content-scaling=fixed&page-id=0%3A1&starting-point-node-id=1%3A2&embed-host=share"
            >
              <span>Uniservices — Colaboradores</span>
            </button>

            <button
              class="tile"
              data-url="https://embed.figma.com/proto/Yr12PfEGdeRbbHJpeFA6T1/Unimed?node-id=190-563&p=f&scaling=min-zoom&content-scaling=fixed&page-id=190%3A297&starting-point-node-id=190%3A354&embed-host=share"
            >
              <span>Uniservices — Lideranças</span>
            </button>

            <button
              class="tile"
              data-url="https://embed.figma.com/proto/Yr12PfEGdeRbbHJpeFA6T1/Unimed?node-id=319-1140&p=f&scaling=min-zoom&content-scaling=fixed&page-id=319%3A1139&starting-point-node-id=319%3A1140&embed-host=share"
            >
              <span>Uniservices — Admin</span>
            </button>
          </div>
        </div>

        <button class="nav next" id="next" aria-label="Próximo" title="Próximo">
          ›
        </button>
      </div>
    </div>

    <!-- Overlay do Figma -->
    <div id="viewer-overlay" hidden>
      <button id="close" aria-label="Fechar (Esc)">Fechar ✕</button>
      <iframe
        id="viewer"
        title="Preview do Figma"
        allow="fullscreen; clipboard-read; clipboard-write; autoplay"
        allowfullscreen
        referrerpolicy="strict-origin-when-cross-origin"
      ></iframe>
    </div>

    <script>
      const viewport = document.getElementById("viewport");
      const track = document.getElementById("tiles");
      const prevBtn = document.getElementById("prev");
      const nextBtn = document.getElementById("next");

      const prefersReduced = window.matchMedia?.(
        "(prefers-reduced-motion: reduce)"
      ).matches;
      const TOL = 4;

      function getMetrics() {
        const first = track.querySelector(".tile");
        if (!first) return { slide: 0, gap: 0, perView: 1 };
        const slide = first.getBoundingClientRect().width;
        const gap = parseFloat(getComputedStyle(track).gap) || 0;
        const perView =
          parseFloat(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--slides-per-view"
            )
          ) || 1;
        return { slide, gap, perView };
      }

      function isScrollable() {
        return track.scrollWidth > viewport.clientWidth + 1;
      }
      function maxScroll() {
        return Math.max(0, track.scrollWidth - viewport.clientWidth);
      }
      function isAtStart() {
        return viewport.scrollLeft <= TOL;
      }
      function isAtEnd() {
        return viewport.scrollLeft >= maxScroll() - TOL;
      }

      function scrollBySlides(dir) {
        const { slide, gap, perView } = getMetrics();
        const delta = (slide + gap) * perView * dir;
        viewport.scrollBy({
          left: delta,
          behavior: prefersReduced ? "auto" : "smooth",
        });
      }
      function scrollToStart() {
        viewport.scrollTo({
          left: 0,
          behavior: prefersReduced ? "auto" : "smooth",
        });
      }
      function scrollToEnd() {
        viewport.scrollTo({
          left: maxScroll(),
          behavior: prefersReduced ? "auto" : "smooth",
        });
      }

      function updateNav() {
        const canScroll = isScrollable();
        prevBtn.disabled = nextBtn.disabled = !canScroll;
      }

      prevBtn.addEventListener("click", () => {
        if (!isScrollable()) return;
        if (isAtStart()) {
          scrollToEnd();
        } else {
          scrollBySlides(-1);
        }
      });

      nextBtn.addEventListener("click", () => {
        if (!isScrollable()) return;
        if (isAtEnd()) {
          scrollToStart();
        } else {
          scrollBySlides(1);
        }
      });

      viewport.addEventListener("scroll", () =>
        requestAnimationFrame(updateNav)
      );
      window.addEventListener("resize", updateNav);
      updateNav();

      let isPointerDown = false;
      let startX = 0;
      let startScroll = 0;

      viewport.addEventListener("pointerdown", (e) => {
        if (!isScrollable()) return;
        isPointerDown = true;
        startX = e.clientX;
        startScroll = viewport.scrollLeft;
        viewport.setPointerCapture(e.pointerId);
        viewport.style.cursor = "grabbing";
      });
      viewport.addEventListener("pointermove", (e) => {
        if (!isPointerDown) return;
        const dx = e.clientX - startX;
        viewport.scrollLeft = startScroll - dx;
      });
      function endDrag() {
        isPointerDown = false;
        viewport.style.cursor = "";
      }
      viewport.addEventListener("pointerup", endDrag);
      viewport.addEventListener("pointercancel", endDrag);
      viewport.addEventListener("mouseleave", endDrag);

      // Teclado: setas esquerda/direita com loop
      viewport.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") {
          e.preventDefault();
          if (isAtEnd()) scrollToStart();
          else scrollBySlides(1);
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          if (isAtStart()) scrollToEnd();
          else scrollBySlides(-1);
        }
      });

      const overlay = document.getElementById("viewer-overlay");
      const viewer = document.getElementById("viewer");
      const closeBtn = document.getElementById("close");

      function openViewer(url) {
        viewer.src = url;
        overlay.hidden = false;

        const el = overlay;
        if (el.requestFullscreen) {
          el.requestFullscreen().catch(() => {});
        }
      }

      function closeViewer() {
        viewer.src = "about:blank";
        overlay.hidden = true;
        if (document.fullscreenElement && document.exitFullscreen) {
          document.exitFullscreen().catch(() => {});
        }
      }

      track.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-url]");
        if (!btn) return;
        openViewer(btn.dataset.url);
      });

      closeBtn.addEventListener("click", closeViewer);
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeViewer();
      });
    </script>
  </body>
</html>
